<%-include('../layouts/adminHeader') %>
<body class="g-sidenav-show  bg-gray-200">
  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3   bg-gradient-dark" id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href=" " target="_blank">
        <img src="/assets/img/logo-ct.png" class="navbar-brand-img h-100" alt="main_logo">
        <span class="ms-1 font-weight-bold text-white">Admin Panel</span>
      </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse  w-auto  max-height-vh-100" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/home">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">dashboard</i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/sales-report">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Sales report</span>
          </a>
        </li>
        <li class="nav-item">
          <!-- <a href="/hi">ividey amarthu</a> -->
          <a class="nav-link text-white " href="/admin/user">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">table_view</i>
            </div>
            <span class="nav-link-text ms-1">User Managment</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/brand">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Brand Mangement</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/category">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Catagory Mangement</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white" href="/admin/product">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">view_in_ar</i>
            </div>
            <span class="nav-link-text ms-1">Product Mangement</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/order">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">format_textdirection_r_to_l</i>
            </div>
            <span class="nav-link-text ms-1">Order Mangement</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/coupon">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">format_textdirection_r_to_l</i>
            </div>
            <span class="nav-link-text ms-1">Coupon Management</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/offer-banner">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">receipt_long</i>
            </div>
            <span class="nav-link-text ms-1">Banner Mangement</span>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link text-white active bg-gradient-primary" href="/admin/offerManagement">
              <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                <i class="material-icons opacity-10">receipt_long</i>
              </div>
              <span class="nav-link-text ms-1">Offer Mangement</span>
            </a>
          </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-white font-weight-bolder opacity-8">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/profile">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">person</i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white " href="/admin/logout">
            <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">login</i>
            </div>
            <span class="nav-link-text ms-1">Logout</span>
          </a>
        </li>
        
      </ul>
    </div>
  </aside>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" navbar-scroll="true">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          
          <h6 class="font-weight-bolder mb-0">Offer Management</h6>
        </nav>
        
      </div>
    </nav>
    <!-- End Navbar -->
    <!-- product table -->
    
<table class="table table-bordered my-3" id="table">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">PRODUCT NAME</th>
        <th scope="col">PRICE</th>
        <th scope="col">OFFER PRICE</th>
        <th scope="col">OFFER %</th>
        <th scope="col">OfferStatus</th>
        <th scope="col">IMAGE</th>
        <th scope="col">QUANTITY</th>
        <th scope="col">MORE</th>
      </tr>
    </thead>
    <tbody>
       <% productData.forEach((value,index)=>{ %>
      <tr>
        <th scope="row"><%= index +1 %></th> 
        <td> <%= value.product_name %></td>
        <td> <%= value.price %></td>
        <td><%= value.offerPrice%></td>
        <td><%= value.offer.offerPercentage%></td>
        <td><%= value.offer.offerStatus %></td>
        <td> <img src="/products/<%= value.image[0] %>" alt="" style="width: 80px; height: 80px;"> </td>
         <td> <%= value.quantity %></td>
         <td>
            <%if(value.offer.offerStatus == false){%>
                <div class="">
            <!-- Button trigger modal -->
            <a class="btn btn-primary text-white" data-bs-toggle="modal" data-bs-target="#exampleModalCenter">
                Add Product Offer
              </a>
              <!-- Modal -->
              <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
              aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Product Offer details</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <!-- form-start -->
        
                    <form  action="/admin/addOfferManagement/<%= value._id%>" method="post" >
                      <div class="form-group">
                        <h4>Product Name : <%= value.product_name %></h4>
                        <h6>Previous Price :â‚¹  <%= value.price %></h6>
                      </div>
                      
        
                      <div class="form-group">
                          <label for="">Offer percentage</label>
                          <input type="number" class="form-control border pe-2 ps-2" id="" placeholder="Offer amount" name="offerPercentage" required>
                      </div>
                      
                      
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Save changes</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
            <% }else{ %>
              <div class="btn-group dropstart" style="width: 100%;height: 100px;" >
                <a href=""   data-bs-toggle="dropdown" aria-expanded="false" class="m-auto " style="width: 100%;" >
                 <i style="font-size:24px" class="fa m-4">&#xf142;</i>
                </a>
                   <ul class="dropdown-menu">
                     <li> <a href="/admin/editOfferManagement/<%= value._id %>" class="btn btn-primary d-block my-1" >EDIT Offer</a></li>
                     <% if(value.offer.offerStatus == false){ %>
                       <li> <a onclick="activeOffer('<%= value._id %>')" class="btn btn-danger d-block my-1">Activate Offer</a></li>
                     <% }else{ %>
                       <li> <a onclick="deleteOffer('<%= value._id %>')" class="btn btn-danger d-block my-1">DELETE Offer</a></li>
                     <% } %>
                   </ul>
                 </div>
             <% } %>
            </td>
      </tr>

      <% }) %>
     
  
    </tbody>
  </table>
  <script>
    function deleteOffer (productId) {
  
  Swal.fire({
      title: 'Are you sure?',
      text: "You want to delete ProductOffer!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, Delete!'
  }).then((result) => {
      if (result.isConfirmed) {
          $.ajax({
              url: '/admin/deleteOfferManagement',
              data: {
                productId:productId,
                
              },
              method: 'delete',
              success: (response) => {
                  console.log("waoring")
                  if(response.success){
                    $('#table').load('/admin/offerManagement #table')
                  console.log(response);
                  Swal.fire({
                      title: 'Deleted ProductOffer!',
                      text: 'Your deleted ProductOffer',
                      icon: 'success',
                      showConfirmButton: false,
                      timer:1000
                  })
                  }else{
                    Swal.fire({
                      icon: 'error',
                      title: 'Oops...',
                      text: 'something error in ProductOffer delete!',
               
                    })
                  }
  
                  
                  
  
              }
  
          })
      }
  })
  }
  
  </script>
  <script>
    function activeOffer (productId) {
  
  Swal.fire({
      title: 'Are you sure?',
      text: "You want to Activate ProductOffer!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, Activate!'
  }).then((result) => {
      if (result.isConfirmed) {
          $.ajax({
              url: '/admin/deleteOfferManagement',
              data: {
                productId:productId,
                
              },
              method: 'delete',
              success: (response) => {
                  console.log("waoring")
                  if(response.success){
                    $('#table').load('/admin/offerManagement #table')
                  console.log(response);
                  Swal.fire({
                      title: 'Activated ProductOffer!',
                      text: 'Your Activated ProductOffer',
                      icon: 'success',
                      showConfirmButton: false,
                      timer:1000
                  })
                  }else{
                    Swal.fire({
                      icon: 'error',
                      title: 'Oops...',
                      text: 'something error in ProductOffer Activation!',
               
                    })
                  }
  
                  
                  
  
              }
  
          })
      }
  })
  }
  
  </script>
  
  


<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.js"></script>



 
    
  <!--   Core JS Files   -->
  <script src="/assets/js/core/popper.min.js"></script>
  <script src="/assets/js/core/bootstrap.min.js"></script>
  <script src="/assets/js/plugins/perfect-scrollbar.min.js"></script>
  <script src="/assets/js/plugins/smooth-scrollbar.min.js"></script>
  <script src="/assets/js/plugins/chartjs.min.js"></script>
  <script>
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/assets/js/material-dashboard.min.js?v=3.0.0"></script>
</body>

</html>